#!/usr/bin/env bash
#MISE description="Inspect the context being sent to Claude"
#MISE usage="inspect-context [--agent <name>] <message>"

set -e

# Parse arguments
AGENT=""
MESSAGE=""

while [[ $# -gt 0 ]]; do
  case $1 in
    --agent)
      AGENT="$2"
      shift 2
      ;;
    *)
      MESSAGE="$1"
      shift
      ;;
  esac
done

MESSAGE="${MESSAGE:-Say hello}"
AGENT="${AGENT:-probe-1}"

cd "$(git rev-parse --show-toplevel)/cli"
mix escript.build >/dev/null 2>&1

./cli --log-context --agent "$AGENT" "$MESSAGE"

# Find the most recent log file
LOG_FILE=$(ls -t /tmp/claude-context-*.log 2>/dev/null | head -1)

if [ -n "$LOG_FILE" ]; then
  echo ""
  echo "=== Context Log ==="
  cat "$LOG_FILE"
fi
