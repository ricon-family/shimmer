#!/usr/bin/env bash
#MISE description="Inspect the context being sent to Claude"
#USAGE flag "--agent <name>" help="Agent to use (default: probe-1)"
#USAGE arg "[message]" help="Message to send (default: Say hello)"

set -e

# Use usage variables with defaults
MESSAGE="${usage_message:-Say hello}"
AGENT="${usage_agent:-probe-1}"

cd "$(git rev-parse --show-toplevel)/cli"
mix escript.build >/dev/null 2>&1

./cli --log-context --agent "$AGENT" --timeout 60 "$MESSAGE"

# Find the most recent log file
LOG_FILE=$(ls -t /tmp/claude-context-*.log 2>/dev/null | head -1)

if [ -n "$LOG_FILE" ]; then
  echo ""
  echo "=== Context Log ==="
  cat "$LOG_FILE"
fi
