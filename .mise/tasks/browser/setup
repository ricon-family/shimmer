#!/usr/bin/env bash
#MISE description="Install Playwright browser (Chromium only)"

set -e

CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/shimmer/browser"
export PLAYWRIGHT_BROWSERS_PATH="$CACHE_DIR"

echo "Installing Playwright Chromium..."
echo "  Browser cache: $CACHE_DIR"
echo ""

npx playwright install chromium

# ESM imports can't use NODE_PATH, so create a node_modules symlink at the
# repo root pointing to mise's playwright install. This keeps it out of
# .mise/tasks/ (where mise would discover executables inside it as tasks).
REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../.." && pwd)"
PLAYWRIGHT_MODULES="$(mise where npm:playwright)/lib/node_modules"
if [ -d "$PLAYWRIGHT_MODULES" ]; then
  ln -sfn "$PLAYWRIGHT_MODULES" "$REPO_ROOT/node_modules"
  echo "  Linked node_modules â†’ $PLAYWRIGHT_MODULES"
fi

echo ""
echo "Done. Run: shimmer browser:login <site>"
