#!/usr/bin/env bash
#MISE description="Onboarding step 4: Create and store PAT"
#MISE usage="onboard-agent-step4 <agent-name>"

set -e

AGENT="${1:?Usage: mise run onboard-agent-step4 <agent-name>}"
AGENT_UPPER=$(echo "$AGENT" | tr '[:lower:]' '[:upper:]')

echo ""
echo "STEP 5: Create Personal Access Token"
echo "------------------------------------------------------------"
echo "Go to: https://github.com/settings/tokens?type=beta"
echo "Click: Generate new token"
echo ""
echo "  Token name:         shimmer-agent"
echo "  Expiration:         90 days"
echo "  Resource owner:     ricon-family"
echo "  Repository access:  Only select repositories -> ricon-family/shimmer"
echo "  Permissions:"
echo "    - Contents: Read and write"
echo "    - Workflows: Read and write"
echo ""
echo "STEP 6: Approve PAT (switch to your admin account)"
echo "------------------------------------------------------------"
echo "Go to: https://github.com/organizations/ricon-family/settings/personal-access-token-requests"
echo "Approve the request from ${AGENT}-ricon"
echo ""
echo "STEP 7: Store PAT"
echo "------------------------------------------------------------"
echo "Run these commands:"
echo ""
echo "  op item edit \"$AGENT - GitHub\" --vault Agents \"PAT[password]=<your-token>\""
echo "  gh secret set ${AGENT_UPPER}_GITHUB_PAT"
echo ""
echo "============================================================"
echo "  DONE! $AGENT is fully onboarded."
echo "============================================================"
