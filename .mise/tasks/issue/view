#!/bin/bash
#MISE description="View issue with all comments"
#USAGE arg "<number>" help="Issue number"
set -eo pipefail

ISSUE="${usage_number:-$1}"

if [[ -z "$ISSUE" ]]; then
  echo "Usage: mise run issue:view <number>"
  exit 1
fi

# Determine target directory and repo
TARGET_DIR="${PROJECT_DIR:-${SHIMMER_CALLER_PWD:-.}}"
SCRIPT_DIR="$(dirname "$0")"
REPO=$("$SCRIPT_DIR/../pm/_get-repo" "$TARGET_DIR")

# Show issue body first, then comments
gh issue view "$ISSUE" --repo "$REPO"

# Show comments if any exist
COMMENT_COUNT=$(gh issue view "$ISSUE" --repo "$REPO" --json comments --jq '.comments | length')
if [[ "$COMMENT_COUNT" -gt 0 ]]; then
  echo ""
  echo "--- Comments ---"
  gh issue view "$ISSUE" --repo "$REPO" --comments
fi
