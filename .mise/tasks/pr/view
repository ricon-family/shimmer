#!/bin/bash
#MISE description="View pull request details"
#USAGE arg "<number>" help="PR number"
set -eo pipefail

PR="${usage_number:-$1}"

if [[ -z "$PR" ]]; then
  echo "Usage: mise run pr:view <number>"
  exit 1
fi

# Get PR details
echo "=== PR #$PR ==="
echo ""

gh pr view "$PR" --json title,author,state,createdAt,additions,deletions,reviewRequests,reviews,body,closingIssuesReferences \
  --template '{{.title}}
Author: {{.author.login}}
State: {{.state}}
Created: {{.createdAt | timefmt "2006-01-02"}}
Changes: +{{.additions}} -{{.deletions}}

{{if .reviewRequests}}Reviewers requested: {{range .reviewRequests}}{{.login}} {{end}}{{end}}
{{if .reviews}}Reviews: {{range .reviews}}{{.author.login}}({{.state}}) {{end}}{{end}}

{{if .closingIssuesReferences}}Linked issues:{{range .closingIssuesReferences}}
  - #{{.number}}: {{.title}}{{end}}
{{else}}Linked issues: none{{end}}

---
{{.body}}
'

echo ""
echo "=== CI Status ==="
gh pr checks "$PR" 2>/dev/null || echo "No checks found"
