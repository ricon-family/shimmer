#!/usr/bin/env bash
#MISE description="Trigger an agent workflow manually"
#MISE usage="trigger <agent> [message]"

set -e

AGENT="${1:-quick}"
MESSAGE="${2:-}"
REPO=$(gh repo view --json nameWithOwner -q .nameWithOwner)

# Map agent names to workflow files
case "$AGENT" in
  quick)
    WORKFLOW="quick.yml"
    ;;
  brownie)
    WORKFLOW="brownie.yml"
    ;;
  junior)
    WORKFLOW="junior.yml"
    ;;
  *)
    echo "Unknown agent: $AGENT"
    echo "Available agents: quick, brownie, junior"
    exit 1
    ;;
esac

if [ -n "$MESSAGE" ]; then
  gh workflow run "$WORKFLOW" -f message="$MESSAGE"
else
  gh workflow run "$WORKFLOW"
fi

echo "Triggered $AGENT on $REPO"
echo "View at: https://github.com/$REPO/actions"
