#!/usr/bin/env bash
#MISE description="List current organization memberships"

set -e

if [ -z "$GH_TOKEN" ] && ! gh auth status &>/dev/null; then
  echo "ERROR: Not authenticated with GitHub" >&2
  echo "Run: eval \$(shimmer as <agent>)" >&2
  exit 1
fi

MEMBERSHIPS=$(gh api "/user/memberships/orgs?state=active" 2>/dev/null)

if [ "$MEMBERSHIPS" = "[]" ]; then
  echo "Not a member of any organizations"
else
  echo "Organization memberships:"
  echo "$MEMBERSHIPS" | jq -r '.[] | "  \(.organization.login) (\(.role))"'
fi
