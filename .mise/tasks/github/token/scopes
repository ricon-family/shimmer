#!/usr/bin/env bash
#MISE description="Show the scopes of the current GitHub token"

set -e

if [ -z "$GH_TOKEN" ]; then
  echo "ERROR: GH_TOKEN not set" >&2
  echo "Run: eval \$(shimmer as <agent>)" >&2
  exit 1
fi

SCOPES=$(gh api /user -i 2>&1 | grep "X-Oauth-Scopes:" | sed 's/X-Oauth-Scopes: //')

if [ -z "$SCOPES" ]; then
  echo "No scopes found (might be a fine-grained PAT)"
else
  echo "Token scopes:"
  echo "$SCOPES" | tr ',' '\n' | sed 's/^ */  /'
fi
