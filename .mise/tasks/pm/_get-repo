#!/bin/bash
# Helper: Get repo name (owner/repo) for a target directory
# Usage: REPO=$("$SCRIPT_DIR/_get-repo" "$TARGET_DIR")
#
# Checks in order:
# 1. .project.toml in target dir
# 2. gh repo view (from git remote)
set -eo pipefail

TARGET_DIR="${1:-.}"

# Try .project.toml first
if [[ -f "$TARGET_DIR/.project.toml" ]]; then
  REPO=$(yq -p toml '.repo' "$TARGET_DIR/.project.toml" 2>/dev/null || true)
  if [[ -n "$REPO" ]]; then
    echo "$REPO"
    exit 0
  fi
fi

# Fall back to gh repo view
REPO=$(cd "$TARGET_DIR" && gh repo view --json nameWithOwner -q .nameWithOwner 2>/dev/null || true)
if [[ -n "$REPO" ]]; then
  echo "$REPO"
  exit 0
fi

# Failed
echo "Error: Could not determine repo for $TARGET_DIR" >&2
exit 1
