#!/usr/bin/env bash
#MISE description="View logs from the latest workflow run"
#USAGE arg "[workflow]" help="Workflow file name (default: pr-check.yml)"
#USAGE arg "[lines]" help="Number of log lines to show (default: 100)"

set -e

WORKFLOW="${1:-pr-check.yml}"
LINES="${2:-100}"
RUN_ID=$(gh run list --workflow="$WORKFLOW" --limit 1 --json databaseId -q '.[0].databaseId')
JOB_ID=$(gh run view "$RUN_ID" --json jobs -q '.jobs[0].databaseId')

gh run view --job="$JOB_ID" --log 2>&1 | tail -"$LINES"
